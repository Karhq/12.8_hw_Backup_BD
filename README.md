# Домашнее задание к занятию «Резервное копирование баз данных» - Карпов Роман

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

#### Ответ:  

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.  
Ну первоначально, основной вариант который подходит - это полное резервное копирование, самый простой, долгий и ресурснозатратный вариант. Делаем полную копию БД, допустим на 00:00.
Из минусов: - требуется много места для хранения копий, высокая загрузка сети и длительное выполнение бэкапа. 

Второй вариант, который на мой взгляд наиболее предпочтительный - это Дифференциальный бекап. 
В этом случае, по мимо полной копии базы (хоть и накопительной), мо получаем возможность провести быстрое восстановление в случае необходимости (и в отличии от инкрементного, нам не необходима вся цепочка бекапов, 
а только первый - полный бекап и точка (день) на который нам необходимо восстановить базу) 
Из минусов - избыточность в накоплении данных.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.  
На мой взгляд отлично подходит вариант Инкрементного резервного копирования. Полная копия базы (первая точка в цикле), будет использоваться как начальная точка. 
Далее идет копирование только тех блоков, которые были изменены (если изменений нет, то бекап на указанное время создан не будет, но т.к. мы говорит про кейс финансовой компании), такое будет маловероятно.
Периодичность резервного копирования, зависит от кейса, в нашем случае раз в час, для уверенности - я бы рассмотрел вариант делать точки восстановления каждые 30 минут. 
В зависимости от политики хранения резервных копий через определенный период создается новая полная копия для повторения цикла, и цикл повторяется (новая начальная точка и далее).
Из минусов: низкая скорость восстановления данных (нам необходимо объединить все точки восстановления в цепочке) и менее надежна с точки зрения восстановления (зависит от целостности всех блоков). 
Поэтому если объем транзакция очень большой, я бы рассматривал цикл - сутки. и раз в 30 минут бэкап. 

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.  
Настройка репликации master-slave.  

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?


#### Ответ:  
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).  

Создание дампа БД, делается с помощью команды (user PostgreSQL):   
```sql  
pg_dump dbname > dumpfile  
```  
Если копирование идет не из под пользователя postgress, то команда будет выглядеть следующим образом: 
```sql  
pg_dump -U name -W users > /tmp/users.dump  
```  
Восстановление БД, м помощью команды (user PostgreSQL):  
```sql  
pg_restore -d dbname dumpfile 
``` 
Где -d - указывает на БД куда будет восстановлен дамп. 

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?


#### Ответ: 
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.   
Для MySQL Enterprise Backup 8.0.17 и более поздних версий вы можете легко создать разностную резервную копию, используя эту опцию 
```sql 
--incremental-base=history:last_full_backup.
``` 
Второй вариант, это использование утилиты XtraBackup:
Создание первой - основной копии:
```sql 
xtrabackup --backup --target-dir=/data/backups/base
```
Создание первой - инкрементной копии
```sql 
xtrabackup --backup --target-dir=/data/backups/inc1 \
--incremental-basedir=/data/backups/base
```
---
